
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(uuid())
  name      String   @unique
  role      String   @default("Banker") // Banker, Lawyer, Borrower
  color     String   @default("bg-slate-700")
  password  String   @default("password123")
  logs      AuditLog[]
  messages  ChatMessage[]
}

model Document {
  id        String   @id @default("main-room")
  title     String   @default("Untitled Deal")
  content   String
  version   Int      @default(1)
  hash      String   @default("genesis") 
  updatedAt DateTime @updatedAt
  logs      AuditLog[]
  messages  ChatMessage[]
}

model AuditLog {
  id           Int      @id @default(autoincrement())
  hash         String
  previousHash String
  action       String
  txHash       String?  // Blockchain Transaction Hash
  timestamp    DateTime @default(now())
  
  // Relations
  user         User     @relation(fields: [userName], references: [name])
  userName     String
  document     Document @relation(fields: [docId], references: [id])
  docId        String
}

model ChatMessage {
  id        Int      @id @default(autoincrement())
  text      String
  timestamp DateTime @default(now())

  // Relations
  user      User     @relation(fields: [userName], references: [name])
  userName  String
  document  Document @relation(fields: [docId], references: [id])
  docId     String
}
